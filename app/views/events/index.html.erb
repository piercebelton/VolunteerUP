<div class="row">
  <div class="col-md-8">
    <h1 class= "vertical-align">Events</h1>
  </div>
  <div class="col-md-4 text-right" id="search-bar">
    <%= form_for_filterrific @filterrific do |f| %>
      <div>
        Search
        <%# give the search field the 'filterrific-periodically-observed' class for live updates %>
        <%= f.text_field(
          :search_query,
          class: 'filterrific-periodically-observed'
        ) %>
      </div>
      <div>
        Sorted by
        <%= f.select(:sorted_by, @filterrific.select_options[:sorted_by]) %>
      </div>
      <div>
        <%= link_to(
          'Reset filters',
          reset_filterrific_url,
        ) %>
      </div>
      <%= render_filterrific_spinner %>
    <% end %>
  </div>
</div>

<div class="row">
  <p id="notice"><%= notice %></p>
</div>

<%= render(
  partial: 'events/list',
  locals: { events: @events }
) %>

<table class="table table-hover">
  <thead>
    <tr>
      <th>Event Info</th>
      <th>Cause</th>
      <th>Organization</th>
      <th>Date and Time</th>
      <th>Event Location</th>
      <th>Spots Remaining</th>
      <th colspan="3"></th>
    </tr>
  </thead>
  <tbody>
    <% @events.each do |event| %>
      <tr>
        <td>
          <strong><%= link_to event.name, event %></strong><br><br>
          <%= event.description %><br><br>
          <% if @ability.can? :manage, event %>
            <%= link_to 'Edit', edit_event_path(event), class: "btn btn-xs btn-info" %>
            <%= link_to 'Destroy', event, method: :delete, data: { confirm: 'Are you sure?' }, class: "btn btn-xs btn-danger"%>
          <% end %>
        </td>
        <td><%= event.cause %></td>
        <td><%= event.organization.name %></td>
        <td>
          <%= event.start_time.strftime("%b %e, %Y")%><br>
          <%= event.start_time.strftime("%l:%M %p") %> -
          <%= event.end_time.strftime("%l:%M %p") %><br>
          (<%= ((event.end_time-event.start_time)/3600).round(1)  %> hours)
        </td>
        <td>
          <%= event.street %><br>
          <%= event.city %>,
          <%= event.state %>
          <%= event.postal_code %>
          <%= event.country %>
        </td>
        <td><%= "#{event.remaining_vol} out of #{event.volunteers_needed}" %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<% if user_signed_in? %>
  <%= link_to 'New Event', new_event_path, class: "btn btn-sm btn-primary" %>
<% end %>
